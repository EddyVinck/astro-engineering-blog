---
import PostList from "../../components/PostList.astro";
import Layout from "../../layouts/Page.astro";
import { CollectionEntry, getCollection } from "astro:content";

export async function getStaticPaths() {
  const topics = await getCollection("topic");
  return topics.map((topic) => ({
    params: { slug: topic.slug },
    props: topic,
  }));
}
type Props = CollectionEntry<"topic">;

const topic = Astro.props;
const { Content } = await topic.render();

const posts = await getCollection("blog");
const topicPosts = posts
  .filter((post) => post.data.draft === false)
  .filter((post) => post.data.topics.includes(topic.slug))
  .sort((a, b) => a.data.pubDate.valueOf() - b.data.pubDate.valueOf());
---

<Layout
  title="Topics"
  description="An overview of all the various topics on our blog."
>
  <section>
    <h1>{topic.data.title}</h1>
    <Content />
    {topicPosts.length === 0 && <p>No posts yet.</p>}
    {
      topicPosts.length > 0 && (
        <>
          <h2>Posts about {topic.data.title.toLowerCase()}</h2>
          <PostList posts={topicPosts} />
        </>
      )
    }
  </section>
</Layout>

<style>
  ul {
    list-style-type: none;
    padding: unset;
  }
  ul li {
    display: flex;
  }
  ul li :global(time) {
    flex: 0 0 130px;
    font-style: italic;
    color: #595959;
  }
  ul li a:visited {
    color: #8e32dc;
  }
</style>
